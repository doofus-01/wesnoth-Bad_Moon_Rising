#textdomain wesnoth-Bad_Moon_Rising
[scenario]
    id="1_09_Pit"
    name= _ "The Pit"
    map_data="{~add-ons/Bad_Moon_Rising/maps/1_09_PitB.map}"
    next_scenario="1_09_Ruin"
    victory_when_enemies_defeated=no
    {TURNS 70 60 55}
    {SCENARIO_MUSIC "the_city_falls.ogg"}

    [time]
        id=thepit
        name= _ "The Pit"
        image=misc/time-schedules/schedule-underground.png
        lawful_bonus=-25
        red=-10
        green=-50
        blue=-50
    [/time]

    {BMR_INIT_LUA}
    {FLAMES 28 52}
    {FLAMES 11 61}
    {FLAMES 27 20}
    {FLAMES 31 20}

    [time_area]
        x=8-16,25-31
        y=58-63,50-55
        [time]
            id=thepit_illum
            name= _ "The Pit"
            image=misc/time-schedules/schedule-underground-illum.png
            red=-5
            green=-40
            blue=-40
        [/time]
    [/time_area]

    [event]
        name=prestart
        {BMR_UNIT_HELP_MENU 1}
	[micro_ai]
            side=4
            ai_type=goto
            action=add
	    [filter]
		id=Scarrion
	    [/filter]
	    [filter_location]
		x,y=29,18
	    [/filter_location]
	    ignore_enemy_at_goal=yes
        [/micro_ai]
        [objectives]
            side=1
            [objective]
                condition=win
                description=_ "Find the imposter"
            [/objective]
            [objective]
                condition=lose
                description=_ "Death of Lorenzon"
            [/objective]
            [objective]
                condition=lose
                description=_ "Death of Belleros"
            [/objective]
            [objective]
                condition=lose
                description=_ "Death of Raenna"
            [/objective]

            {TURNS_RUN_OUT}
        [/objectives]
        [set_variable]
            name=no_maskov
            value=yes
        [/set_variable]
        [item]
            x=8
            y=63
            image=scenery/gate-rusty-sw.png
        [/item]
        [item]
            x=11
            y=12
            image=items/altar-evil.png
        [/item]
        [item]
            x=23
            y=11
            halo=halo/inferno3.png
        [/item]
        [item]
            x=36
            y=57
            image=items/box.png
        [/item]
        [item]
            x=36
            y=58
            image=items/box.png
        [/item]
        [gear_item]
            x=36
            y=58
            gear_id = ancient_ring
        [/gear_item]
        [item]
            x=33
            y=67
            image=items/box.png
        [/item]
        [gear_item]
            x=33
            y=67
            gear_id = ancient_cloak
        [/gear_item]
        [item]
            x=34
            y=65
            image=items/book1.png
        [/item]
        [item]
            x=36
            y=67
            image=items/bones.png
        [/item]
        [gear_item]
            x=36
            y=67
            gear_id = gold_ring
        [/gear_item]
        [item]
            x=17
            y=21
            image=items/bones.png
        [/item]
        [item]
            x,y=23,51
            image=scenery/trash.png
        [/item]
        [item]
            x,y=19,51
            image=scenery/trash.png
        [/item]
        [item]
            x,y=15,45
            image=scenery/trash.png
        [/item]
        [item]
            x,y=13,43
            image=scenery/trash.png
        [/item]
        [item]
            x=24
            y=77
            image=scenery/trash.png
        [/item]
        [item]
            x=9
            y=94
            image=scenery/trash.png
        [/item]
        {DOG_WOOF 33 67}
        {DOG_WOOF 36 67}
        {DOG_WOOF 36 57}
        {DOG_WOOF 36 58}
        {CLEAR_VARIABLE scarrion}
        [set_variable]
            name=dog_pass
            value=0
        [/set_variable]
        [set_variable]
            name=dog_pass2
            value=0
        [/set_variable]
    [/event]

    [side]
        type=Lieutenant
        id=Lorenzon
        name="Lorenzon"
        side=1
        canrecruit=yes
        controller=human
        shroud=yes
        recruit=Ukian Runner, Ukian Regular, Ukian Archer, Ukian Dog
        {GOLD 450 400 350}
        {INCOME 4 3 2}
        team_name=good
    [/side]

    [side]
        type=Orcish Warlord
        id=Tahn Gareth
        name="Tahn Gareth"
        profile="portraits/tahn.png"
        side=2
        canrecruit=yes
        controller=ai
        shroud=yes
        recruit=Wolf Rider, Rat Rider
        {GOLD 200 180 160}
        {INCOME 8 6 4}
        team_name=bad
        [ai]
            #	aggression=0.8
            #	grouping=offensive
        [/ai]
        [unit]
            type=Orcish Warrior
            generate_name=yes
            x,y=22,82
            ai_special=guardian
        [/unit]
        [unit]
            type=Orcish Slayer
            id=Orc_Spy
            generate_name=yes
            x,y=30,86
            ai_special=guardian
        [/unit]
    [/side]

    {BMR_GARETH_NAMES 2}

    [side]
        type=Primevalist Leader
        id=Vazzan
        name= _ "General"+" Vazzan"
        profile="portraits/vazzan.png"
        side=3
        canrecruit=yes
        controller=ai
        shroud=yes
        recruit=Primevalist Fighter, Primevalist Fanatic, Primevalist Shield, Primevalist Follower, Primevalist Monk
        {GOLD 400 450 550}
        {INCOME 8 10 12}
        team_name=evil
        [ai]
            #	aggression=0.7
            #	grouping=offensive
            #	recruitment_pattern=mixed fighter,mixed fighter,archer
            #	caution=0.9
        [/ai]
        [unit]
            type=Primevalist Shield
            generate_name=yes
            x,y=9,97
            ai_special=guardian
        [/unit]
        [unit]
            type=Primevalist Shield
            generate_name=yes
            x,y=11,65
            ai_special=guardian
        [/unit]
        [unit]
            type=Primevalist Shield
            generate_name=yes
            x,y=9,64
            ai_special=guardian
        [/unit]
        [unit]
            type=Primevalist Shield
            generate_name=yes
            x,y=5,63
            ai_special=guardian
        [/unit]
        [unit]
            type=Primevalist Shield
            x,y=3,62
            generate_name=yes
            ai_special=guardian
        [/unit]
        [unit]
            type=Primevalist Shield
            x,y=11,79
            generate_name=yes
            ai_special=guardian
        [/unit]
        [unit]
            type=Primevalist Shield
            x,y=7,79
            generate_name=yes
            ai_special=guardian
        [/unit]
        [unit]
            type=Primevalist Fighter
            generate_name=yes
            x,y=11,93
            ai_special=guardian
        [/unit]
        [unit]
            type=Primevalist Fighter
            generate_name=yes
            x,y=11,60
            ai_special=guardian
        [/unit]
        [unit]
            type=Primevalist Fighter
            generate_name=yes
            x,y=30,102
            ai_special=guardian
        [/unit]
        [unit]
            type=Primevalist Fighter
            generate_name=yes
            x,y=21,95
            ai_special=guardian
        [/unit]
        [unit]
            type=Primevalist Fanatic
	    name="Caroc"
	    id=Caroc
            x,y=28,51
            ai_special=guardian
        [/unit]
        [unit]
            type=Primevalist Fighter
            id=Guard1
            name= _ "Guard"
            x,y=13,98
            ai_special=guardian
        [/unit]
        [unit]
            type=Primevalist Shield
            id=Guard2
            name= _ "Guard"
            x,y=15,101
            ai_special=guardian
        [/unit]
        [unit]
            type=Primevalist Fanatic
            id=Guard3
            name= _ "Guard"
            x,y=31,95
            ai_special=guardian
        [/unit]
        [unit]
            type=Primevalist Fighter
            id=Guard4
            name= _ "Guard"
            x,y=7,107
            facing=se
            ai_special=guardian
        [/unit]
        [unit]
            type=Primevalist Follower
            id=Guard6
            name= _ "Guard"
            x,y=3,104
            facing=se
            ai_special=guardian
        [/unit]
    [/side]

    [side]
# the FAI is not maintained, need to use something else
#        {ai/aliases/stable_singleplayer.cfg}
#        [ai]
#            # this had been set to 2, but I am changing this to 4 (v0.9.10)
#            {MODIFY_AI_ADD_CANDIDATE_ACTION 4 main_loop (
#                [candidate_action]
#                    id=push_to_destination
#                    engine=fai
#                    name=push_to_destination
#                    type=movement
#                    #   the intent of the formula is "let all units do the move
#                    #   before combat". we can use if() to limit the units who are
#                    #   affected. e.g.
#                    #   if(me.id='overpowered_unit',{AI_CA_COMBAT_SCORE}+10,0)
#                    evaluation="if(me.id='Scarrion',{AI_CA_COMBAT_SCORE}+10,0)"
#                    #   the intent of the formula is "move from my current location
#                    #   to the location which is closest to my destination,
#                    #   ignoring enemy units" We'll end next to them if they block
#                    #   our way, and we'll fight in the combat phase normally.
#                    action="move(me.loc,choose(unit_moves(me.loc),'mloc',-sum(map(simplest_path(mloc,loc(29,18),me.loc),'path_location', movement_cost( me, path_location ) ))) )"
#                [/candidate_action]
#            )}
#        [/ai]
        no_leader=yes
        side=4
        shroud=no
        team_name=evil
        [unit]
            type=Dark Messiah
            id=Scarrion
            name= _ "Scarrion"
            x,y=23,48
        [/unit]
        [unit]
            type=Primevalist Fanatic
            x,y=9,39
            generate_name=yes
            ai_special=guardian
        [/unit]
#ifdef HARD
        [unit]
            type=Primevalist Fanatic
            x,y=20,39
            id=Guard5
            generate_name=yes
            ai_special=guardian
        [/unit]
#endif
#ifndef EASY
        [unit]
            type=Primevalist Shield
            x,y=20,41
            generate_name=yes
            ai_special=guardian
        [/unit]
#endif
        [unit]
            type=Primevalist Shield
            x,y=19,38
            generate_name=yes
            ai_special=guardian
        [/unit]
        [unit]
            type=Primevalist Shield
            x,y=8,79
            generate_name=yes
            ai_special=guardian
        [/unit]
        [unit]
            type=Primevalist Shield
            x,y=10,79
            generate_name=yes
            ai_special=guardian
        [/unit]
        [unit]
            type=Primevalist Shield
            x,y=18,58
	    id=Shield1
            generate_name=yes
            ai_special=guardian
        [/unit]
        [unit]
            type=Primevalist Shield
            x,y=13,73
            generate_name=yes
            ai_special=guardian
        [/unit]
        [unit]
            type=Primevalist Fanatic
	    id=Fanatic_Guard_M1
            x,y=29,63
            generate_name=yes
            ai_special=guardian
        [/unit]
    [/side]

    [side]
        side=5
        no_leader=yes
        team_name=ghosts
        [ai]
            aggression=0.6
            caution=0.1
		[aspect]
	            id=attacks
	        	[facet]
	        	    invalidate_on_gamestate_change=yes
	        	    [filter_enemy]
	        	        id=Scarrion
	        	    [/filter_enemy]
	        	[/facet]
	    	[/aspect]
        [/ai]
    [/side]

    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 "Primevalist Shield" 6}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Wolf Rider" 2}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Rat Rider" 1}

    [event]
        name=prestart
        [recall]
            id=Raenna
            x,y=9,106
        [/recall]
        [recall]
            id=Belleros
            x,y=12,106
        [/recall]
# 20160515 - giving the player some more fresh blood.  Need to come up with a fluff reason for this?
	[unit]
	    type=Ukian Dog
	    side=1
            x,y=14,110
	[/unit]	    
	[unit]
	    type=Ukian Regular
	    side=1
            x,y=8,109
	[/unit]	    
	[unit]
	    type=Ukian Runner
	    side=1
            x,y=12,109
	[/unit]	    
#ifdef __UNUSED__
        [recall]
            side=1
            level=0
            x,y=14,110
        [/recall]
        [recall]
            side=1
            level=1
            x,y=8,109
        [/recall]
        [recall]
            side=1
            level=1
            x,y=12,109
        [/recall]
#endif
        [recall]
            side=1
            level=3
            x,y=12,108
        [/recall]
        [recall]
            side=1
            level=2
            x,y=13,108
        [/recall]
        [store_unit]
            [filter]
                id=Scarrion
            [/filter]
            kill=yes
            variable=scarrion
        [/store_unit]
    [/event]

    [event]
        name=start
        [message]
            speaker=narrator
            message = _ "The Ukians hurried through the part of the mine where the undead had been, and continued deeper into unknown territory."
            image="wesnoth-icon.png~SCALE(205,205)"
        [/message]
        [message]
            speaker=Guard4
            message = _ "<i><b>Intruders!!</b></i>"
        [/message]
        {MODIFY_UNIT (side=1) facing nw}
        [message]
            speaker=Guard3
            message = _ "Relayed!  They won't get very far..."
        [/message]
        [message]
            speaker=Guard6
            message = _ "You're too late, Order is nigh! We have been hard at work while you danced with Tyrant Huric."
        [/message]
# these boots are to aid in chasing Scarrion.
	[apply_gear]
	    id=Fanatic_Guard_M1
	    gear_id=miner_boots
	[/apply_gear]
	[apply_gear]
	    id=Guard2
	    gear_id=fiber_armor
	[/apply_gear]
	[apply_gear]
	    id=Guard6
	    gear_id=fur_cloak
	[/apply_gear]
	[apply_gear]
	    id=Caroc
	    gear_id=steel_helmet
	[/apply_gear]
	[apply_gear]
	    id=Shield1
	    gear_id=iron_shield
	[/apply_gear]
	[apply_gear]
	    id=Vazzan
	    gear_id=breastplate
	[/apply_gear]
	[apply_gear]
	    id=Vazzan
	    gear_id=silver_sword
	[/apply_gear]
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            x=23-29
        [/filter]
        [message]
            speaker=Belleros
            message = _ "It's rather warm down here..."
        [/message]
        [message]
            speaker=Tahn Gareth
            message = _ "I hear voices of the enemy! The troll was right!"
        [/message]
        [message]
            speaker=Raenna
            message = _ "You talk too much, Belleros."
        [/message]
        [unit]
            side=2
            type=Troll
            id=Guide
            name= _ "Gareth's Guide"
            x,y=25,78
        [/unit]
        [unit]
            side=2
            type=Rat Lancer
            name=Gornk Gareth
            x,y=30,75
        [/unit]
        [unit]
            side=2
            type=Orcish Warrior
            generate_name=yes
            x,y=28,80
        [/unit]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Guard6
        [/filter]
        [filter_second]
            race=ukian
        [/filter_second]
        [message]
            speaker=unit
            message= _ "I -<i>cough!</i>- have no regrets about standing up to the pawns of oppressors..."
        [/message]
        [message]
            speaker=second_unit
            message= _ "I'm not a pawn, to an oppressor or anyone else!"
        [/message]
        [message]
            speaker=unit
            message= _ "Lies!  You look not much different from ... the soldiers that ...  took ... "
        [/message]
    [/event]
    [event]
        name=die
        [filter]
            id=Guard6
        [/filter]
        [filter_second]
            race=ukian
        [/filter_second]
        [message]
            speaker=second_unit
            message= _ "So, these people are rebels like us?"
        [/message]
        [message]
            speaker=Lorenzon
            message= _ "No, they may be rebels, but they are not quite like us."
        [/message]
    [/event]
    [event]
        name=last breath
        [filter]
            id=Guard5
        [/filter]
        [filter_second]
            race=ukian
        [/filter_second]
        [message]
            speaker=unit
            message= _ "The Restoration will bring you down, enjoy your final hours..."
        [/message]
        [message]
            speaker=second_unit
            message= _ "I'm really sick of the drivel coming from these people."
        [/message]
    [/event]
    [event]
        name=last breath
        [filter]
            id=Guard3
        [/filter]
        [filter_second]
            race=ukian
        [/filter_second]
        [message]
            speaker=unit
            message= _ "I only regret I fall so soon. But it does not matter, you cannot stop us..."
        [/message]
        [message]
            speaker=second_unit
            message= _ "What does that mean! Who are you people and what are you doing here?"
        [/message]
        [message]
            speaker=Belleros
            message= _ "He is dead..."
        [/message]
    [/event]
    [event]
        name=last breath
        [filter]
            id=Guard4
        [/filter]
        [filter_second]
            race=ukian
        [/filter_second]
        [message]
            speaker=unit
            message= _ "I spit on you!"
        [/message]
        [message]
            speaker=second_unit
            message= _ "Who are you people and what are you doing here!"
        [/message]
        [message]
            speaker=Lorenzon
            message= _ "He is dead, we won't get any information out of him."
        [/message]
    [/event]
    [event]
        name=die
        [filter]
            id=Lorenzon
        [/filter]
        [message]
            speaker=unit
            message= _ "Ugh. What a mess..."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
    [event]
        name=die
        [filter]
            id=Belleros
        [/filter]
        [message]
            speaker=Lorenzon
            message= _ "I can't lose my officers like this..."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
    [event]
        name=die
        [filter]
            id=Raenna
        [/filter]
        [message]
            speaker=Lorenzon
            message= _ "This is not going well..."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=attack end
        [filter]
            side=2,1
        [/filter]
        [filter_second]
            side=1,2
        [/filter_second]
        [fire_event]
            name=orc_fight
        [/fire_event]
    [/event]

    [event]
        name=orc_fight
        [message]
            speaker=Tahn Gareth
            message= _ "That's right! Kill them! This hell-hole needs to be destroyed!"
        [/message]
        [message]
            speaker=Lorenzon
            message= _ "Wait! We're not here to stop you, we're here to stop the other humans! They are the ones aspiring to dominance of the North, not us!"
        [/message]
        [message]
            speaker=Tahn Gareth
            message= _ "Huh! (Is that really true? How can I take the word of a human?)"
        [/message]
        [message]
            speaker=Orc_Spy
            message= _ "The humans were fighting with each other, he could be telling the truth..."
        [/message]
        [message]
            speaker=Tahn Gareth
            message= _ "I see ... "
        [/message]
        [delay]
            time=300
        [/delay]
        [message]
            speaker=Tahn Gareth
            message= _ "Very well. We're allies for now. But when they are dead, you go away! Try funny stuff and we kill you!"
        [/message]
        [modify_side]
            id=Tahn Gareth
            side=2
            team_name=good
        [/modify_side]
    [/event]

    [event]
        name=enter_hex
        [filter]
            id=Lorenzon
            x,y=23,80-86
        [/filter]
        [if]
            [have_unit]
                side=3
                x=15-24
                y=80-86
            [/have_unit]
            [then]
                [message]
                    speaker=Lorenzon
                    message=_"The enemy is strong in the face of your forces, Orc Chief.  You need our help."
                [/message]
                [message]
                    speaker=Tahn Gareth
                    message=_"I must not leave this nest of worms unturned.  Others of my banner will be here soon, we cannot be defeated by these."
                [/message]
            [/then]
        [/if]
        [message]
            speaker=Lorenzon
            message=_"May I ask, Orc Chief, how you got here ahead of us?  We saw no signs of an orcish force in the old mines..."
        [/message]
        [message]
            speaker=Tahn Gareth
            message=_"We came directly through the opening over there.  It is hidden in the mountains, and you fragile little people are not very observant."
        [/message]
        [message]
            speaker=Lorenzon
            message=_"Hrm...  May I use that passage to bring the rest of my forces in?  We wanted to move quickly, and the path through the old mines is quite long and winding."
        [/message]
        [message]
            speaker=Raenna
            message=_"(<i>hisses:</i>  You're telling the orc that we are cut off from our main forces!)"
        [/message]
        [message]
            speaker=Tahn Gareth
            message=_"I said we were allies for now, and my word is as solid as rock.  But how can I trust that you are not merely trying to entrench your side here?  I'll need some convincing..."
        [/message]
        {MOVE_UNIT (id=Lorenzon) 28 78}
        [message]
            speaker=Lorenzon
            message=_"I give you this gift, which I would not do if I intended to fight you later, for it makes you stronger and myself weaker."
        [/message]
        [message]
            speaker=narrator
            message=_"Lorenzon placed supplies worth about 50g on the ground for the orcish leader."
        [/message]
        [gold]
            amount=-50
            side=1
        [/gold]
        [floating_text]
            x,y=28,78
            text="<span color='#aa9922'>"+ _"-50 g" + "</span>"
        [/floating_text]
        [gold]
            amount=50
            side=2
        [/gold]
        [floating_text]
            x,y=28,75
            text="<span color='#cccc33'>"+ _"50 g" + "</span>"
        [/floating_text]
        [message]
            speaker=Tahn Gareth
            message=_"...  I still don't trust you, but I shall allow you to bring your forces in through our passage."
        [/message]
        {MOVE_UNIT (id=Lorenzon) 31 79}
        [terrain]
            terrain=Ce
            x=30,31,32
            y=78-79,78-80,78-79
        [/terrain]
        [terrain]
            terrain=Ke
            x,y=31,79
        [/terrain]
        [redraw]
            side=1
        [/redraw]
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            [not]
                type=Ukian Dog,Ukian Attack Dog, Ukian Harrier,Ukian War Hound
            [/not]
            x,y=36,57
        [/filter]
        [message]
            speaker=unit
            message= _ "This box is filled with strange little objects, I don't have any idea what they could be for..."
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            [not]
                type=Ukian Dog,Ukian Attack Dog, Ukian Harrier,Ukian War Hound
            [/not]
            x,y=36,67
            #	test		x,y=5,92
        [/filter]
        [message]
            speaker=unit
            message= _ "These bones are not human. It has the remnants of cloths, but there are too many limbs... This ring is covered in grime, but I recognize it as one of the prized gold rings people trade."
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            [not]
                type=Ukian Dog,Ukian Attack Dog, Ukian Harrier,Ukian War Hound
            [/not]
            x,y=33,67
            #	test		x,y=5,92
        [/filter]
        [message]
            speaker=unit
            message= _ "This box contains some exotic cloth. It seems just as substantial as the fibers we have, but is less stiff and scratching..."
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            [not]
                type=Ukian Dog,Ukian Attack Dog, Ukian Harrier,Ukian War Hound
            [/not]
            x,y=36,58
            #	test		x,y=5,92
        [/filter]
        [message]
            speaker=unit
            message= _ "As near as I can tell, this box contains a lot of junk. Well, there is this old ring..."
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            y=1-52
        [/filter]
        [unstore_unit]
            variable=scarrion
        [/unstore_unit]
        {CLEAR_VARIABLE scarrion}
        [music]
            name="legends_of_the_north.ogg"
            immediate=yes
        [/music]
        [message]
            speaker=Scarrion
            message= _ "The barbarians are closing in! You know what to do General..."
        [/message]
        [message]
            speaker=Lorenzon
            message= _ "The face is different but the voice is the same! Your plot is over, Duval or whoever you are!"
        [/message]
        [message]
            speaker=Scarrion
            message= _ "Ha! Hello Lorenzon, I guess I never did really introduce myself. As you've figured out, I'm not Duval. My name is Scarrion. Now, I must be going..."
        [/message]
        [message]
            speaker=Vazzan
            message= _ "Heathens! Your adventures end here."
        [/message]
#ifndef EASY
        [unit]
            side=3
            type=Primevalist Fighter
            x,y=24,48
        [/unit]
        [unit]
            side=3
            type=Primevalist Fighter
            x,y=26,47
        [/unit]
        [unit]
            side=3
            type=Primevalist Fanatic
            x,y=25,49
        [/unit]
        [unit]
            side=3
            type=Primevalist Fanatic
            x,y=26,48
        [/unit]
#endif
        [objectives]
            side=1
            [objective]
                condition=win
                description=_ "Kill Scarrion"
            [/objective]
            [objective]
                condition=lose
                description=_ "Death of Lorenzon"
            [/objective]
            [objective]
                condition=lose
                description=_ "Scarrion escapes (see note)"
            [/objective]

            {TURNS_RUN_OUT}
            note= _ "Don't let Scarrion get beyond the two fires near the top of the map."
        [/objectives]
        {MODIFY_UNIT id=Scarrion goto_x 2}
        {MODIFY_UNIT id=Scarrion goto_y 44}
        [modify_side]
            side=3
            gold=60
        [/modify_side]
    [/event]

    # Scarrion is running north.  The AI won't cooperate, so I'm forcing it w/ teleport
    # This was more important in an earlier version of the map, so there is a macro, SCARRION_HOP,
    # but I'm spelling it out here to add a message.  I'm keeping the macro until I know how this
    # will be resolved.

    #	[event]
    #	name=attack_end
    #	[filter]
    #	side=1
    #	[/filter]
    #	[filter_second]
    #	description=Scarrion
    #	[/filter_second]
    #	[if]
    #	[filter]
    #	y=43-51
    #	[/filter]
    #	[then]
    #	{FLASH_BLUE (
    #	[teleport]
    #	    [filter]
    #		description=Scarrion
    #	    [/filter]
    #	x=13
    #	y=38
    #	[/teleport]
    #	)}
    #	[redraw]
    #	[/redraw]
    #	[message]
    #	speaker=Lorenzon
    #	message= _ "Some sort of flash bomb?  Press on!  He can't have gone far!"
    #	[/message]
    #	[/then]
    #	[/if]
    #	[/event]
    #
    #	{SCARRION_HOP 31-43 27 32}

#ifdef __UNUSED__

    # Leading the AI by the nose
    # though this still doesn't seem to work.
    [event]
        name=moveto
        first_time_only=no
        [filter]
            id=Scarrion
            x=1-20
            y=45-50
        [/filter]
        {MODIFY_UNIT id=Scarrion goto_x 2}
        {MODIFY_UNIT id=Scarrion goto_y 44}
    [/event]
    [event]
        name=moveto
        first_time_only=no
        [filter]
            id=Scarrion
            x=1-5
            y=35-44
        [/filter]
        {MODIFY_UNIT id=Scarrion goto_x 6}
        {MODIFY_UNIT id=Scarrion goto_y 37}
    [/event]
    [event]
        name=moveto
        first_time_only=no
        [filter]
            id=Scarrion
            x=6-19
            y=35-43
        [/filter]
        {MODIFY_UNIT id=Scarrion goto_x 20}
        {MODIFY_UNIT id=Scarrion goto_y 38}
    [/event]
    [event]
        name=moveto
        first_time_only=no
        [filter]
            id=Scarrion
            x=20-35
            y=25-39
        [/filter]
        {MODIFY_UNIT id=Scarrion goto_x 28}
        {MODIFY_UNIT id=Scarrion goto_y 24}
    [/event]
    # At this point, the [ai] parameters will take over (hopefully)
#endif

    [event]
        name=enter_hex
        [filter]
            id=Scarrion
            y=28
        [/filter]
        # so that if the player defeats Scarrion before Maskov shows up, the story still makes sense.  This variable is used in the intro of the next sccenario.
        [set_variable]
            name=no_maskov
            value=no
        [/set_variable]
        [unit]
            side=1
            type=General
            id=Maskov
            name= _ "General Maskov"
            profile="portraits/maskov.png"
            x,y=28,23
            #	generate_name=yes
        [/unit]
        [store_unit]
            [filter]
                id=Maskov
            [/filter]
            kill=yes
            variable=maskov
        [/store_unit]
# this may be overdoing it...
#        [set_variable]
#            name=maskov.status.poisoned
#            value=yes
#        [/set_variable]
        [set_variable]
            name=maskov.hitpoints
            value=12
        [/set_variable]
        [unstore_unit]
            variable=maskov
            find_vacant=no
        [/unstore_unit]
        {CLEAR_VARIABLE maskov}
        [redraw]
            side=1
        [/redraw]
        [music]
            name=the_dangerous_symphony.ogg
            immediate=yes
            append=yes
        [/music]
        [message]
            speaker=Maskov
            message= _ "Not so fast, back-stabbing knave!"
        [/message]
        [message]
            speaker=Scarrion
            message= _ "How is this?  You should be dead!"
        [/message]
        [message]
            speaker=Maskov
            message= _ "You are -<i>cough!</i>- not as clever as you think you are!"
        [/message]
        [message]
            speaker=Scarrion
            message= _ "You are weak, you will not stop me..."
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            [not]
                race=ukiandog
            [/not]
            x,y=23,51
        [/filter]
        [message]
            speaker=unit
            message= _ "There is a narrow passage - *hrmff* - it's too narrow for me, probably for anyone else too."
        [/message]
        [message]
            speaker=Belleros
            message= _ "Maybe the dogs can get through?"
        [/message]
    [/event]

    [event]
        name=enter_hex
        first_time_only=no
        [filter]
            race=ukiandog
            x,y=23,51
        [/filter]
        [if]
            [variable]
                name=dog_pass
#ifdef EASY
                equals=4
#endif
#ifdef NORMAL
                equals=3
#endif
#ifdef HARD
                equals=2
#endif
            [/variable]
            [then]
                [message]
                    speaker=unit
                    message= _ "Woof!"
                [/message]
                [message]
                    speaker=narrator
                    message= _ "The dog refused to go through the tunnel.  Just moments later, some rocks fell into the small tunnel, effectively sealing it off."
                [/message]
                [tunnel]
                    id=doggy_tunnel
                    remove=yes
                [/tunnel]
            [/then]
            [else]
                [allow_undo]
                [/allow_undo]
            [/else]
        [/if]
        [set_variable]
            name=dog_pass
            add=1
        [/set_variable]
    [/event]

    [event]
        name=enter_hex
        first_time_only=no
        [filter]
            race=ukiandog
            x,y=15,45
        [/filter]
        [if]
            [variable]
                name=dog_pass2
#ifdef EASY
                equals=4
#endif
#ifdef NORMAL
                equals=3
#endif
#ifdef HARD
                equals=2
#endif
            [/variable]
            [then]
                [message]
                    speaker=unit
                    message= _ "Woof!"
                [/message]
                [message]
                    speaker=narrator
                    message= _ "The dog refused to go through the tunnel.  Just moments later, some rocks fell into the small tunnel, effectively sealing it off."
                [/message]
                [tunnel]
                    id=doggy_tunnel2
                    remove=yes
                [/tunnel]
            [/then]
            [else]
                [allow_undo]
                [/allow_undo]
            [/else]
        [/if]
        [set_variable]
            name=dog_pass2
            add=1
        [/set_variable]
    [/event]

    [event]
        name=moveto
        [filter]
            race=ukiandog
            x,y=23,51
        [/filter]
        [message]
            speaker=unit
            message= _ "Woof!  *(scratch, scratch, scratch)*"
        [/message]
        [teleport]
            [filter]
                id=$unit.id
            [/filter]
            x,y=19,51
            animate=no
        [/teleport]
        [tunnel]
            id=doggy_tunnel
            bidirectional=yes
            [source]
                x,y=19,51
            [/source]
            [target]
                x,y=23,51
            [/target]
            [filter]
                race=ukiandog
            [/filter]
        [/tunnel]
    [/event]

    [event]
        name=moveto
        [filter]
            race=ukiandog
            x,y=15,45
        [/filter]
        [message]
            speaker=unit
            message= _ "Woof!  *(scratch, scratch, scratch)*"
        [/message]
        [teleport]
            [filter]
                id=$unit.id
            [/filter]
            x,y=13,43
            animate=no
        [/teleport]
        [tunnel]
            id=doggy_tunnel2
            bidirectional=yes
            [source]
                x,y=15,45
            [/source]
            [target]
                x,y=13,43
            [/target]
            [filter]
                race=ukiandog
            [/filter]
        [/tunnel]
    [/event]

    [event]
        name=moveto
        [filter]
            id=Scarrion
            y=1-19
        [/filter]
        [message]
            speaker=Scarrion
            message= _ "Haha! You cannot stop me, Lorenzon. No one can stop me! This will be your grave..."
        [/message]
        {EARTHQUAKE(
            [kill]
                side=1
                animate=no
            [/kill]
        )}
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Tahn Gareth
        [/filter]
        [message]
            speaker=unit
            message= _ "Gha... There will be others... We'll clean out this rat's nest..."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Astreya
        [/filter]
        [message]
            speaker=unit
            message= _ "You are strong, but this is not over... As long as you killers live, it can never be over..."
        [/message]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Maskov
        [/filter]
        [message]
            speaker=unit
            message= _ "Lorenzon, it's bad... I saw... wrote it here..."
        [/message]
        [message]
            speaker=narrator
            message= _ "As he expired, General Maskov fumbled with a scrap of animal hide."
            image=wesnoth-icon.png
        [/message]
        [kill]
            id=$unit.id
            animate=yes
        [/kill]
        [message]
            speaker=Lorenzon
            message= _ "Check his corpse when possible. (Rest in peace, General.)"
        [/message]
        [unit]
            type=Phantom Queen
            side=5
            id=Astreya
            x,y=29,22
            name= _ "Astreya"
        [/unit]
#ifdef EASY
        {GENERIC_UNIT 5 "Phantom Cloak" 30 21}
        {GENERIC_UNIT 5 "Phantom Cloak" 28 21}
#endif
#ifdef NORMAL
        {GENERIC_UNIT 5 "Phantom Cloak" 30 21}
#endif

        [message]
            speaker=Astreya
            message= _ "You will pay for that, evil one.  He was my brother..."
        [/message]
        [message]
            speaker=Scarrion
            message= _ "Who the hell are you?"
        [/message]
        [message]
            speaker=Astreya
            message= _ "His sister, of course..."
        [/message]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Scarrion
        [/filter]
        [store_unit]
            [filter]
                x,y=$x2,$y2
            [/filter]
            variable=ikillscarrion
            kill=no
        [/store_unit]
        [message]
            speaker=unit
            message= _ "Graaahhh!"
        [/message]
        {THUNDER(
            [kill]
                id=Scarrion
                animate=no
            [/kill]
        )}
        [if]
            [variable]
                name=ikillscarrion.race
                equals=ukiandog
            [/variable]
            [then]
                [message]
                    speaker=second_unit
                    message= _ "Woof?"
                [/message]
            [/then]
            [else]
                [message]
                    speaker=second_unit
                    message= _ "No! Did he escape?"
                [/message]
            [/else]
        [/if]
        [kill]
            side=5
            animate=no
        [/kill]
        [message]
            speaker=Lorenzon
            message= _ "There was something very strange about him... If he was some sort of spirit, might he die with a flash?"
        [/message]
        [message]
            speaker=Raenna
            message= _ "The path ahead is quite narrow, I doubt he could have escaped through it undetected."
        [/message]
        [message]
            speaker=Tahn Gareth
            message= _ "HUMANS! We agreed not to fight each other down here. We will honour that, but we will still drive you dogs out of the northlands!"
        [/message]
        [message]
            speaker=Lorenzon
            message= _ "The bad man was up to something down here, we would-"
        [/message]
        [message]
            speaker=Tahn Gareth
            message= _ "<b>No!</b> I said you'd die if you tried any funny stuff! Now you go <i>out</i>! We will destroy this cave and seal the entrance."
        [/message]
        [message]
            speaker=Lorenzon
            message= _ "I guess we must leave. We shouldn't be separated from the non-combatants so long anyway."
        [/message]
        #	[if]
        #	    [have_unit]
        #		id=Maskov
        #	    [/have_unit]
        #		[else]
        #		[set_variable]
        #		name=no_maskov
        #		value=yes
        #		[/set_variable]
        #		[/else]
        #	[/if]
        [message]
            speaker=Maskov
            message= _ "<i>COUGH!</i>  I'd hoped I might be able to recover, but ... There is something ... you should know. I wrote it down..."
        [/message]
        [kill]
            id=Maskov
            animate=yes
        [/kill]
        {CLEAR_VARIABLE ikillscarrion}
        [endlevel]
            result=victory
        [/endlevel]
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            [not]
                race=ukiandog
            [/not]
            x,y=34,65
        [/filter]
        [message]
            speaker=unit
            message= _ "Hmmm... Nope, I cannot read this. I once saw a script from the mages of old, but I've never seen this type of writing before."
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            [not]
                type=Ukian Dog
            [/not]
            y=60-72
        [/filter]
        [modify_side]
            side=3
            [ai]
                #			aggression=0.6
                #			caution=1.2
            [/ai]
        [/modify_side]
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            [not]
                type=Ukian Dog
            [/not]
            y=40-50
        [/filter]
        [modify_side]
            side=3
            [ai]
                #			aggression=0.9
                #			caution=0.7
            [/ai]
        [/modify_side]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Vazzan
        [/filter]
        [message]
            speaker=unit
            message= _ "Argh! I've fallen to infidels?!"
        [/message]
        [message]
            speaker=Lorenzon
            message= _ "He was a fool, just here to slow us down.  We must stop Scarrion!"
        [/message]
    [/event]

    [event]
        name=time over
        {THUNDER (
        )}
        [message]
            speaker=Lorenzon
            message= _ "What the hell was that!?!?"
        [/message]
        [message]
            speaker=Scarrion
            message= _ "Haha! You're too late! Take a good look..."
        [/message]
        {EARTHQUAKE (
            [kill]
                side=1
                animate=no
            [/kill]
            [message]
                speaker=Scarrion
                message= _ "... at your grave!"
            [/message]
        )}
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
[/scenario]
